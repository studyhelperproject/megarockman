# Technical Context

## 1. Core Technologies & Stack
- **Languages:** JavaScript, TypeScript (for core game logic and automation scripting)
- **Frameworks & Libraries:** Phaser.js (HTML5 2D game engine), Node.js + npm (development environment), Gemini API (AI-assisted image and code generation)
- **Asset Sources:** OpenGameArt, Kenney, itch.io (free 8-bit style assets), Gemini API for missing assets
- **Platforms:** Web browsers (desktop and mobile compatible)
- **Package Managers:** npm, yarn, or pnpm (suggest npm for simplicity)

## 2. Architectural Patterns
- **Overall Architecture:** Component-based 2D game engine architecture using Phaser's Scene and GameObject system. Modular structure separating game logic, asset loading, UI, and AI generation tasks.

- **Directory Structure Philosophy:**
  - `/src`: Game source code and logic scripts
  - `/assets`: Static assets (images, sounds), some autogenerated by Gemini
  - `/scripts`: AI generation orchestration and automation scripts for Gemini API usage
  - `/build`: Compiled/transpiled outputs ready for deployment
  - `/docs`: Documentation including this AGENTS.md and technical specs
  - `/scripts`: AI generation orchestration and automation scripts for Gemini API usage
    - `/scripts/tasks`: YAML files defining generation tasks for the AI agent.

## 3. Coding Conventions & Style Guide
- **Formatting:** Use standard JS/TS formatting (Prettier recommended). 2 spaces indent.
- **Naming Conventions:** camelCase for variables and functions, PascalCase for classes. Constants in UPPER_SNAKE_CASE.
- **API Design:** Object-oriented style with Phaser's Scene subclassing. Clear separation of input handling, game state, and rendering.
- **Extensibility:** Use Phaser's plugin system and custom components to enable adding new enemies, weapons, and stages without core changes.
- **Error Handling:** Use standard try/catch where needed; rely on Phaser's event system for runtime error reporting.

## 4. Key Files & Entrypoints
- `src/main.ts` or `src/main.js`: Game entry point, initializes Phaser game instance, loads main scene.
- `scripts/gemini-agent.ts`: Automation scripts handling Gemini API calls for asset and code generation.
- `src/scenes/StageSelectScene.ts`: Stage selection logic.
- `src/scenes/GameScene.ts`: Main gameplay logic.
- `src/assets/`: Holds static and generated assets.
- `package.json` / `tsconfig.json`: Project dependency and TypeScript configuration.

## 5. Development & Testing Workflow
- Use `npm install` to set up dependencies.
- Run development server via `npm run dev` (e.g. using Vite or Webpack Dev Server).
- Use automated scripts in `/scripts` to update assets via Gemini API (`node scripts/gemini-agent.ts`).
- Test gameplay both locally and on deployed environments (GitHub Pages, Vercel).
- Write unit tests for critical logic using Jest or similar.

## 6. Deployment
- **Platform:** The project is deployed to GitHub Pages.
- **Workflow:** Deployment is handled automatically by the workflow defined in `.github/workflows/deploy.yml`. This workflow builds the application and prepares it for deployment.
- **Repository Settings:** For the deployment to succeed, the repository's settings must be configured correctly.
  - Go to `Settings` > `Pages`.
  - Under `Build and deployment`, set the **Source** to **"GitHub Actions"**.
- **URL Structure:** The `vite.config.ts` is configured with `base: '/megarockman/'`.
- **Final URL:** The live application is accessible at `https://studyhelperproject.github.io/megarockman/`.

## 7. 技術スタック一覧

### コアエンジン・レンダリング

- **Phaser.js（v3）**
オープンソースHTML5 2Dゲームエンジン。WebGL\&Canvas両対応、物理エンジン・アニメーション・入力・サウンド管理など総合サポート。


### 言語・環境

- **JavaScript / TypeScript**
ゲームロジック・シーン設計・AI制御に利用。TypeScript化すれば型安全＆開発効率アップもできるよ。
- **Node.js + npm**
ライブラリ管理・開発サーバー（Live ServerやExpress、Vite/Next.js併用もOK）。


### アセット管理・生成

- **無料アセットサイト**
OpenGameArt, Kenney, itch.io などの8bit素材セット
- **Gemini画像生成API**
テキストプロンプトからキャラ・背景・UI部品自動生成（PNG、SVG, スプライトシート）
- **PhaserのAsset Loader**
画像・音声・JSON・Tilemap等をプリロード、アセットパス自動管理。


### サウンド

- **Ogg/MP3/WAV対応無料素材**＋Gemini生成
- **Phaser Audio System**（SE/BGM再生、ループ、ボリューム・パン設定）


### 入力対応

- **Phaser 標準のキーボード/マウス/タッチ/ゲームパッドサポート**（クロスデバイス）。


### テスト・デプロイ

- **Live Server / Vercel / Netlify / GitHub Pages**
開発・公開フロー自動化（CI連携可）


### オプション

- **React/Next.js連携**（スコアランキングやプロフィール表示等の外部UI連携用に選択可）
- **TypeScript**
クラス整理・型安全・Geminiコード生成時のバグ抑制
